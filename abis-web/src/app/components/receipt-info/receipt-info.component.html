
<nz-page-header class="site-page-header" nzTitle="Поступление" nzSubtitle="{{receipt.name}}">
 
</nz-page-header>


<!--Карточка поступлений, которая состоит из двух табов -->
  <div>
    <button nz-button nzType="link" routerLink="/receipts">Назад</button>

    <button
      *ngIf="!(workStatusForReceipt$  | async)"
      nz-button
      nzType="primary"
      (click)="editModeReceipt()"
      [disabled]="!!(workStatusForReceipt$  | async)"
      >
        Редактировать
    </button>

    <button 
      *ngIf="!(workStatusForReceipt$  | async)"
      nz-button 
      nzType="primary" 
      nzDanger>
      Удалить
    </button>

    <button
      *ngIf="(workStatusForReceipt$  | async)"
      nz-button 
      nzType="primary"
      [disabled]="!(isFormValid$ | async)"
      (click)="viewModeReceipt()">
      Сохранить изменения
    </button>
    <button 
      *ngIf="(workStatusForReceipt$  | async)"
      nz-button 
      nzType="primary" 
      nzDanger
      (click)="viewModeReceipt()">
      Отменить изменения
    </button>
    
  
    <div>
      <nz-tabset>
        <nz-tab nzTitle="Сведения">

         <!--Информация о поступлении-->

          <!--Просмотр-->
          <p *ngIf="!(workStatusForReceipt$  | async)"> Название: {{receipt.name}}</p>
          <p *ngIf="!(workStatusForReceipt$  | async)"> Дата создания: {{receipt.createdDate | date:'medium'}}</p>

          <!--Редактиирование-->
         <form *ngIf="(workStatusForReceipt$  | async)" [formGroup]="receiptForm" nz-form (ngSubmit)="submitReceiptForm()">
          <!--Наименование-->
          <nz-form-item>
              <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="Name">Название</nz-form-label>
              <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="The input is not valid Name!">

                <!--Редактирование-->
                <input
                  nz-input 
                  type="text" 
                  id="Name" 
                  placeholder="enter name"
                  formControlName="Name" 
                  />

              </nz-form-control>
          </nz-form-item>

          <!--Дата создания-->
          <nz-form-item>
              <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="CreatedDate">Дата создания</nz-form-label>
              <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="Please input created date!">

                <!--Редактирование-->
                <input 
                  placeholder="enter created date"
                  nz-input
                  type="datetime-local"
                  nzSize="default" 
                  id="CreatedDate" 
                  formControlName="CreatedDate" 
                />

              </nz-form-control>
          </nz-form-item>
        </form>

        <div>{{receiptForm.value | json}}</div>

        </nz-tab>

        <nz-tab nzTitle="Издания">
          <!--Добавить издание-->
          <button
            nz-button 
            nzType="primary">
            Добавить издание
          </button>

           <!--Информация о книгах в режиме просмотра-->
           <!--Не могу туда подставить переменную хранилища ругается и говорит что readonly ему нужно-->
           <nz-table [nzData]="(instances$ | async)?? []">
            <thead>
              <tr>
                <th>Номер</th>
                <th>Информация об издании</th>
                <th>Режим работы</th>
              </tr>
            </thead>
  
            <tbody>
              <tr *ngFor="let instance of instances$ | async; index as i">
               
                <td>{{i}}</td>

                 <!--Тут будем вызывать форму или ячейку таблицы-->
                <td *ngIf="instance.id != mainId || !(workStatus$ | async)"> {{instance.info}} </td>
                <td *ngIf="instance.id == mainId && !!(workStatus$ | async)">
                  <input  
                    nz-input
                    [(ngModel)]="instance.info"
                    nzSize="default" 
                    placeholder="enter info"
                    type="text" 
                    id="Info" 
                  />
                </td>

                
                <td>

                  <!--Режим редактирования-->
                  <button
                    nz-button
                    nzType="link"
                    (click)="editMode(instance.id)"
                    [disabled]="(workStatus$ | async) && instance.id == mainId"
                    >
                    <span nz-icon nzType="edit" nzTheme="outline"></span>
                  </button>

                  <!--Сохранить изменения-->
                  <button *ngIf="(workStatus$ | async) && instance.id == mainId" nz-button nzType="link" (click)="viewMode()">
                    <span nz-icon nzType="check" nzTheme="outline"></span>
                  </button>

                  <!--Отменить изменения-->
                  <button *ngIf="(workStatus$ | async) && instance.id == mainId" nz-button nzType="link" (click)="viewMode()">
                    <span nz-icon nzType="close" nzTheme="outline"></span>
                  </button>

                </td>

              </tr>
            </tbody>
          </nz-table>
        </nz-tab>
      </nz-tabset>
    </div>
  </div>

  <div>{{receiptId$ | async | json}}</div>
  <div>{{receiptName$ | async | json}}</div>
  <div>{{receiptCreatedDate$ | async | json}}</div>